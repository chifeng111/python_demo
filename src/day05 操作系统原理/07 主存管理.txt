07 主存管理

1、主存管理概述
	1) 主存管理的功能：
		a、映射逻辑地址到物理主存地址；
		b、在多用户之间分配物理主存；
		c、对各用户区的信息提供保护；
		d、扩充逻辑主存区。
	2) 虚拟存储器（virtual memory）：将用户的逻辑主存与物理主存分开。
		由操作系统和硬件配合完成主存和外部存储器之间的信息动态调度，这样的计算机系统好像为用户提供了一个其存储容量比实际主存大得多的存储器。
	3) 主存映射：使一个程序装如到与其地址空间不一致的存储空间所引起的，对有关地址部分的调整，又称为地址重定位。
		a、编程或编译时确定地址映射关系；（早期计算机中使用）
		b、静态地址映射；
			把程序装入主存时实现的，在这种情况下，一个已经开始执行的程序是无法在主存中移动的；同时，该程序再次调入主存时还需放在主存的同一位置。
		c、动态地址映射。
			虚实地址的对应关系在程序执行过程中实现的，一般由硬件实现，重定位寄存器。
	4) 主存分配
		a、主存划分：
			一是将主存划分为大小不等的区域 -----> 按区分配或按段分配
			二是将主存划分为一系列大小相等的块 -----> 按页分配
		b、管理存储器的调度策略：放置策略、调入策略、淘汰策略。
	5) 存储保护
		a、上、下界防护：设置一对上下界寄存器。
		b、存储键防护

2、分区存储管理
	1) 分区分配机构（数据结构）：
		a、主存资源信息块（m_rib）：包括等待队列指针、空闲区队列指针、主存分配程序入口地址。
		b、分区描述器（pd）：
			分配标志flag：0表示分区空闲
			分区大小size：
			勾连字next：
	2) 分区的分配与回收
		a、分配一个主存块（request）：在空闲区队列中找到一个满足此要求的可用空闲区，如果空闲区比要求的大，则分为两部分。
		b、回收一个主存块（release）：回收工作检查是否有临近空闲区，如有则合并。
	3) 几种基本放置策略
		a、首次适应算法：空闲区按位置顺序链在一起
		b、最佳适应算法：空闲区队列按从小到大递增顺序链在一起
		c、最坏适应算法：空闲区队列按从小到大递减顺序链在一起
	4) 碎片问题及拼接技术
		a、碎片：已分配区之间存在着没有被充分利用的空闲区。
		b、拼接技术：移动存储器中某些已经分配区中的信息，使本来分散的空闲区连成一个大的空闲区。
		c、拼接时机选择：一是某个分区回收时立即拼接；二是找不到足够大的空闲区，而总空闲容量可以满足作业要求时进行拼接。
		d、拼接成本较高，使用受到限制。
		
3、页式存储管理
	1) 思想：避开程序对连续性地址空间的要求，将主存等分成一系列的块，程序地址空间被等分为同样大小一系列的页面，然后将页面放到主存块中。
	2) 页式地址变换
		a、页表：在页式系统中，实现地址变换的机构称为页面映像表，简称页表。功能是将逻辑地址变换为物理地址的动态重定位。
		b、虚地址结构：页号、页内位移。
		c、联想存储器：存放页表部分内容的快速存储器。
	3) 请调策略
		扩展页表内容，添加中断位i和辅存地址。
		当i=1，表示此页不在主存，需要将该页调入主存才能继续运行；
		当i=0，表示此页在主存，得到页号并算出页内偏移就能执行。
	4) 淘汰策略（置换算法）
		a、最佳算法（OPT算法）
		b、先进先出算法（FIFO算法）
		c、最久未使用淘汰算法（LRU算法）
		d、最不经常使用淘汰算法（LFU算法）
	5) 页式系统的存储分配
		主存资源信息块：等主存队列指针、存储分块表首址、页式分配程序入口地址。
		存储分块表：记录主存中每个存储块的状态，第一个表目指向第一个空闲块的指针，主存中所有空闲块链在一起。
		
4、段式系统
	1) 思想：分区存储管理容易出现碎片，页式系统相连几个虚页上存放的内容不是完整的信息单位，调用一页可能只用到页中部分内容，使用效率不高。
	2) 段式系统：作业由若干逻辑分段组成，如代码分段、数据分段、栈段。容易对分段进行共享和保护。
	3) 地址变换：段表
	4) 扩充段表功能：引入R、W、E、A位，表示可读、可写、可执行、可追加。

5、段页式存储管理
	1) 思想：结合段式存储管理和分页存储管理。
	2) 数据结构：每一个程序一张段表，每个段又建立一张页表，段表中的地址是页表的起始地址，而页表中的地址是某页主存块号。
		
		