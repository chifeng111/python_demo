04 并发处理

1、并发活动
	1) 程序的顺序执行
		a、顺序性
		b、封闭性
		c、可再现性
	2) 程序的并发执行
		a、失去了程序的封闭性
		b、程序与计算不再一一对应
		c、程序并发执行的相互制约
		
2、进程的概念
	1) 进程定义：进程是指一个具有独立功能的程序关于某个数据集合的一次运行活动。
	2) 进程与程序的区别：
		a、程序是指令的有序集合，没有任何运行的含义，是一个静态概念。而进程是程序在处理机上的一次执行过程，是动态的概念。
		b、程序可以作为资料长期保存。进程有一定的生命周期，能动态的产生和消亡。
	3) 进程的状态
		a、就绪状态（ready）：进程获得除CPU以外的所有资源，已经准备就绪。
		b、运行状态（running）：进程得到中央处理机控制权，它的程序正在运行。
		c、等待状态/阻塞状态（wait）：进程正在等待某一事件发生（如等待输入/输出完成）而暂时停止执行。
	4) 进程状态变迁图
		a、运行状态 -----> 等待状态，由于进程请求某种服务。
		b、等待状态 -----> 就绪状态，当请求的服务完成。
		c、就绪状态 -----> 运行状态，由于进程的调度。
		d、运行状态 -----> 就绪状态，？？
	5) 进程控制块
		a、概念（process control block，PCB）：
			一个与进程相联系的数据块，用于描述一个进程和其它进程以及系统资源之间的关系，和刻画一个进程在各不同时期的状态。
		b、每个进程都由一个程序段（包括数据），和一个进程控制块PCB组成。
	6) 线程的概念特点
		a、概念：线程是比进程更小的活动单位，它是进程中的一个执行路径。
		b、线程与进程的区别:
			A 线程是任务调度的单位，也是系统资源的分配单位。当系统支持多线程时，线程仅仅是任务调度的单位。
			B 线程完全继承父进程的占有资源，当它活动时有自己的运动现场。
		c、线程的特点：
			A 相当与进程，线程的创建与管理开销小得多。
			B 在进程中创建多线程，可以提高系统的并行处理能力。
		d、线程的状态：
			创建，就绪，运行，等待，终止。

3、进程控制
	1) 概念：
		a、进程控制是对系统中的全部进程实施有效的管理。是通过执行各种原语操作来实现的。
		b、原语是一种特殊的系统调用，原语执行不可中断，所以原语具有原子性，是不可再分的。
		c、进程控制原语有：创建原语，撤销原语，阻塞原语，唤醒原语等。
	2) 进程创建:
		无论系统进程还是用户进程，必须由创建原语实现。
		创建原语的形式为：pid = create(name, priority, start_addr)
	3) 进程撤销：
		功能是将运行的进程的PCB结构归还到PCB资源池，所占资源归还给父进程，从总链队列摘除它，然后转进程调度程序。
		撤销原语的形式为：kill()或exit()
	4) 进程阻塞：
		当进程等待某一事件完成时，它可以调用阻塞原语把自己挂起。
		阻塞原语的形式为：susp(chan)，其中chan为等待的事件（阻塞原因）。
	5) 进程唤醒：
		阻塞状态的进程不能自己唤醒自己，必须由发现者用唤醒原语叫醒它。
		唤醒原语的形式为：wakeup(chan)，其中chan为等待的事件（阻塞原因）。
	
4、进程的相互制约关系
	1) 间接相互制约关系：竞争系统资源
		这种制约由操作系统的资源管理程序来协调。
	2) 直接相互制约关系：存在共享数据
		这种制约导致进程之间需要按一定的方式进行信息传递，即进程通信关系，分为：进程互斥、进程同步、进程的直接通信。
	3) 进程互斥
		a、临界资源：通常把一次仅允许一个进程使用的资源称为临界资源。包括物理设备（打印机、输入设备等）和一些软件资源（变量、数据等）。
		b、临界区：每个进程中，访问临界资源的那段代码，称为临界区，或临界段。
		c、互斥：当某一进程正在访问某一存储区域时，不允许其它进程来读取或修改该区域，将这种进程间的相互制约关系称为互斥。
	4) 进程同步
		所谓同步，就是并发进程在一些关键点上可能需要互相等待与互通消息，这种相互制约的等待与互通消息称为进程同步。

5、同步机构
	1) 概念：为了实现进程间正确的协作，操作系统必须提供实现进程协作的措施，称为同步机构。同步机构包括：
		a、锁同步机构（上锁和开锁操作）
		b、信号灯同步机构（P、V操作）
	2) 锁同步机构:
		对每一共享数据块或设备都要有一个单独的锁位。锁位值为“0”表示资源可用，“1”表示资源不可用。
	3) 信号灯同步机构：
		信号灯是一个确定的二元组(s,q)，s代表资源实体或并发进程的状态，初始值为非负的整型。q是初始为空的队列。
		P操作：首先，s值减1。若结果大于或等于0，进程继续执行；否则，进程被封锁，被插入到该信号灯的等待队列中。
		V操作：首先，s值加1。若结果大于0，进程继续执行；否则从信号灯的等待队列中移出一个进程，解除它的等待状态。
		
6、进程通信(interprocess communication, IPC)
	1) 概念：进程通信利用消息(message)，明确地将消息从一个进程的地址空间拷贝到另一个进程的地址空间，而不使用共享存储器的一种通信机制。
	2) 消息：是发送进程形成的一个信息块，通过信息的语法表示传送内容到接受进程。
			
7、UNIX系统进程管理
	1) 进程映像：UNIX系统中的进程实体称为进程映像(image)。由三部分组成：进程基本控制块proc结构、正文段、数据段。
		
	2) 进程状态及变迁
		a、运行状态：进程的运行状态实际是在核态和用户态两种状态下转换。分为用户运行状态和核心运行状态。
		b、就行状态：分为在主存中就绪，就绪且换出。
		c、睡眠状态：分为高优先睡眠，低优先睡眠。
		d、创建状态：由进程执行系统调用fork，创建新的进程。该进程存在但还没就绪，也未睡眠。是除0#进程外所有进程的初始状态。
		e、僵死状态：进程执行系统调用exit后，处于僵死状态，等待父进程做善后处理。
		
		
		
