06 处理机调度

1、处理机的多级调度
	1) 批处理系统中的处理机调度
		作业调度：又称宏观调度，其任务是对提交给系统的存放在辅存上的大量作业，以一定的策略进行挑选，分配主存等资源，建立作业对应的进程，使其投入运行。
		进程调度：又称微观调度，其任务是在进入主存的所有进程中确定哪一个进程在什么时候获得处理机，使用多长时间等。
	2) 多任务操作系统中的处理机调度
		a、系统将用户提交的任务作为进程，一个进程可以创建多个子进程。系统创建进程时为其分配必要的资源。
		b、进程调度
	3) 多线程操作系统中的处理机调度
		a、系统为进程分配必要的资源
		b、线程调度：当处理机空闲时，以某种策略选择一个就绪线程去运行，并为它分配处理机时间。

2、作业调度
	1) 作业的状态
		a、后备状态：作业输入到磁盘后备作业队列上，该作业进入系统等待调度。
		b、执行状态：从作业进入主存开始运行，到作业计算完成为止。
		c、完成状态：从作业计算完成，到善后处理完毕推出系统。
	2) 作业调度的功能（完成从后备状态到执行状态，以及从执行状态到完成状态的转变）
		a、确定数据结构：作业控制块
		b、确定调度算法
		c、分配资源：主存，外部设备。CPU资源的分配由进程调度完成
		d、善后处理
	3) 作业控制块(job control block, JCB)
		每个作业进入系统时由系统建立JCB，只有当作业推出系统时，JCB才被撤销。
		JCB的内容：作业名、作业类型、作业状态、改作业对系统资源的要求、已分配给该作业的资源使用情况、作业优先级。
	4) 调度算法性能的衡量
		a、周转时间：从作业进入系统，到作业完成所需要的时间。
		b、作业的平均周转时间：
		c、带权周转时间：作业的周转时间除以作业的实际执行时间（从作业开始执行到完成）。
		d、作业平均带权周转时间：
	5) 作业调度算法
		a、先来先服务调度算法：容易实现但效率低
		b、短作业优先调度算法：易于实现，但不考虑长作业的利益
		c、响应比高者优先调度算法：上面两种算法的折中
		d、优先调度算法：确定作业的优先数，可通过赋值和计算得到。

3、进程调度
	1) 调度和分派
		调度：负责将一个进程插入到就绪队列并按一定原则保持队列结构。
		分派：将进程从就绪队列移出并建立该进程执行的机器状态。
	2) 进程调度的功能和调度准则
		a、进程调度的具体功能：记录和保持所有进程的有关状态、决定分配策略、实施处理机的分配和回收。
		b、进程调度的准则：
			A CPU使用率
			B 吞吐量：一个时间单元内所完成的进程数量
			C 周转时间：从作业进入系统到完成的时间间隔。
			D 响应时间：从用户向计算机发出指令到计算机执行完成该命令，并将执行结果返回给该用户。
			E 等待时间：进程在就绪队列中等待所花费的时间和。
	3) 调度方式
		非剥夺方式和可剥夺方式
	4) 进程优先数调度算法
		该算法预先确定各进程的优先数，系统将处理机的使用权赋予就绪队列中具备最高优先级的就绪进程。
		a、静态优先数：进程所索取的系统资源越多，估计运行时间越长，其优先级越低。
		b、动态优先数：当进程重新调度时或当进程耗尽一个时间定额时，优先数被调整，以反映进程的动态变化。
	5) 循环轮转调度：系统规定一个时间片，当时间片用完，进程变为就绪态插入就绪队列末端。
		a、简单循环轮转调度：时间片q的计算公式为: q=t/n。t为用户可以接受的响应时间，n为进入系统的进程数目。q通知为100 ms
		b、可变时间片轮转调度：每一轮开始时，系统更具就绪队列中已有的进程数计算一次q值，然后进行轮转。
	6) 多级反馈队列调度：系统有多个就绪队列，每个就绪队列优先级递减，时间片长度递增。
		a、首先进入序数较小的队列，当时间片用完进入下一级（序数加1，时间片加1倍）就绪队列；
		b、序数较大的队列中的进程，只有在其上所有队列为空时，才有机会被调度。
	7) 调度的进程状态变迁图
	
4、线程调度：系统为每个线程分配一个优先级，线程就绪队列按优先级的高低排序，对优先级相同的线程，则遵循队列“先进先出”的原则。

5、UNIX系统的进程调度算法
	1) UNIX系统的进程调度算法是优先数算法，优先数越小，优先级越高。优先数的确定方法有设置和计算两种。
	2) 优先数的设置：当进程因某种原因要睡眠时，在核心调用sleep放弃CPU，并设置优先数。
		a、优先数的大小取决于睡眠的原因，如果是等待较为紧迫的事件，优先数为负，反之为正。
		b、进程0（对换进程）等待对换设备传输时优先数为-100。如果一个进程等待打印机，优先数为10。
	3) 优先数的计算：进程正在或即将装入用户态时，用计算的方法确定优先数。
		公式：p_pri = min{127, p_cpu/16 - p_nice + PUSER}
		p_cpu: 使用CPU的程度
		p_nice: 进程优先数偏置值，用户可设置
		PUSER: 固定偏置常数，100。
	4) 进程切换调度程序swtch

	
	
	